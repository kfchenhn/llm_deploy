import{m as K,a4 as W,a as N,r as Z}from"./RightOutlined-DwIomfBA.js";import{Y as P,c as G,_ as Q,aU as X,aV as J,Z as S,r as v,ad as U,a0 as _}from"./index-CLsQvrEo.js";import{u as M,g as $,r as R,f as ee,d as z}from"./utils-DBnL8xdY.js";import{g as k}from"./index-BK7uUOCN.js";var te="[object Symbol]";function ne(e){return typeof e=="symbol"||K(e)&&W(e)==te}var re=/\s/;function se(e){for(var l=e.length;l--&&re.test(e.charAt(l)););return l}var oe=/^\s+/;function ae(e){return e&&e.slice(0,se(e)+1).replace(oe,"")}var H=NaN,ie=/^[-+]0x[0-9a-f]+$/i,ce=/^0b[01]+$/i,le=/^0o[0-7]+$/i,ue=parseInt;function V(e){if(typeof e=="number")return e;if(ne(e))return H;if(N(e)){var l=typeof e.valueOf=="function"?e.valueOf():e;e=N(l)?l+"":l}if(typeof e!="string")return e===0?e:+e;e=ae(e);var o=ce.test(e);return o||le.test(e)?ue(e.slice(2),o?2:8):ie.test(e)?H:+e}var j=function(){return Z.Date.now()},fe="Expected a function",de=Math.max,pe=Math.min;function Ie(e,l,o){var i,f,p,h,u,b,x=0,A=!1,E=!1,T=!0;if(typeof e!="function")throw new TypeError(fe);l=V(l)||0,N(o)&&(A=!!o.leading,E="maxWait"in o,p=E?de(V(o.maxWait)||0,l):p,T="trailing"in o?!!o.trailing:T);function y(c){var t=i,m=f;return i=f=void 0,x=c,h=e.apply(m,t),h}function d(c){return x=c,u=setTimeout(a,l),A?y(c):h}function n(c){var t=c-b,m=c-x,I=l-t;return E?pe(I,p-m):I}function r(c){var t=c-b,m=c-x;return b===void 0||t>=l||t<0||E&&m>=p}function a(){var c=j();if(r(c))return g(c);u=setTimeout(a,n(c))}function g(c){return u=void 0,T&&i?y(c):(i=f=void 0,h)}function w(){u!==void 0&&clearTimeout(u),x=0,i=b=f=u=void 0}function O(){return u===void 0?h:g(j())}function s(){var c=j(),t=r(c);if(i=arguments,f=this,b=c,t){if(u===void 0)return d(b);if(E)return clearTimeout(u),u=setTimeout(a,l),y(b)}return u===void 0&&(u=setTimeout(a,l)),h}return s.cancel=w,s.flush=O,s}const Te=["xxxl","xxl","xl","lg","md","sm","xs"],ge=e=>({xs:`(max-width: ${e.screenXSMax}px)`,sm:`(min-width: ${e.screenSM}px)`,md:`(min-width: ${e.screenMD}px)`,lg:`(min-width: ${e.screenLG}px)`,xl:`(min-width: ${e.screenXL}px)`,xxl:`(min-width: ${e.screenXXL}px)`,xxxl:`{min-width: ${e.screenXXXL}px}`});function Ee(){const[,e]=P();return G(()=>{const l=ge(e.value),o=new Map;let i=-1,f={};return{matchHandlers:{},dispatch(p){return f=p,o.forEach(h=>h(f)),o.size>=1},subscribe(p){return o.size||this.register(),i+=1,o.set(i,p),p(f),i},unsubscribe(p){o.delete(p),o.size||this.unregister()},unregister(){Object.keys(l).forEach(p=>{const h=l[p],u=this.matchHandlers[h];u==null||u.mql.removeListener(u==null?void 0:u.listener)}),o.clear()},register(){Object.keys(l).forEach(p=>{const h=l[p],u=x=>{let{matches:A}=x;this.dispatch(Q(Q({},f),{[p]:A}))},b=window.matchMedia(h);b.addListener(u),this.matchHandlers[h]={mql:b,listener:u},u(b)})},responsiveMap:l}})}var F={exports:{}};F.exports;(function(e,l){(function(o,i){var f={};o.PubSub?(f=o.PubSub,console.warn("PubSub already loaded, using existing version")):(o.PubSub=f,i(f)),e!==void 0&&e.exports&&(l=e.exports=f),l.PubSub=f,e.exports=l=f})(typeof window=="object"&&window||X,function(o){var i={},f=-1,p="*";function h(n){var r;for(r in n)if(Object.prototype.hasOwnProperty.call(n,r))return!0;return!1}function u(n){return function(){throw n}}function b(n,r,a){try{n(r,a)}catch(g){setTimeout(u(g),0)}}function x(n,r,a){n(r,a)}function A(n,r,a,g){var w=i[r],O=g?x:b,s;if(Object.prototype.hasOwnProperty.call(i,r))for(s in w)Object.prototype.hasOwnProperty.call(w,s)&&O(w[s],n,a)}function E(n,r,a){return function(){var w=String(n),O=w.lastIndexOf(".");for(A(n,n,r,a);O!==-1;)w=w.substr(0,O),O=w.lastIndexOf("."),A(n,w,r,a);A(n,p,r,a)}}function T(n){var r=String(n),a=!!(Object.prototype.hasOwnProperty.call(i,r)&&h(i[r]));return a}function y(n){for(var r=String(n),a=T(r)||T(p),g=r.lastIndexOf(".");!a&&g!==-1;)r=r.substr(0,g),g=r.lastIndexOf("."),a=T(r);return a}function d(n,r,a,g){n=typeof n=="symbol"?n.toString():n;var w=E(n,r,g),O=y(n);return O?(a===!0?w():setTimeout(w,0),!0):!1}o.publish=function(n,r){return d(n,r,!1,o.immediateExceptions)},o.publishSync=function(n,r){return d(n,r,!0,o.immediateExceptions)},o.subscribe=function(n,r){if(typeof r!="function")return!1;n=typeof n=="symbol"?n.toString():n,Object.prototype.hasOwnProperty.call(i,n)||(i[n]={});var a="uid_"+String(++f);return i[n][a]=r,a},o.subscribeAll=function(n){return o.subscribe(p,n)},o.subscribeOnce=function(n,r){var a=o.subscribe(n,function(){o.unsubscribe(a),r.apply(this,arguments)});return o},o.clearAllSubscriptions=function(){i={}},o.clearSubscriptions=function(r){var a;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&a.indexOf(r)===0&&delete i[a]},o.countSubscriptions=function(r){var a,g,w=0;for(a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&a.indexOf(r)===0){for(g in i[a])w++;break}return w},o.getSubscriptions=function(r){var a,g=[];for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&a.indexOf(r)===0&&g.push(a);return g},o.unsubscribe=function(n){var r=function(m){var I;for(I in i)if(Object.prototype.hasOwnProperty.call(i,I)&&I.indexOf(m)===0)return!0;return!1},a=typeof n=="string"&&(Object.prototype.hasOwnProperty.call(i,n)||r(n)),g=!a&&typeof n=="string",w=typeof n=="function",O=!1,s,c,t;if(a){o.clearSubscriptions(n);return}for(s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(c=i[s],g&&c[n]){delete c[n],O=n;break}if(w)for(t in c)Object.prototype.hasOwnProperty.call(c,t)&&c[t]===n&&(delete c[t],O=!0)}return O}})})(F,F.exports);var he=F.exports;const Le=J(he);var be=(e=>(e[e.success=0]="success",e[e.parsed=1]="parsed",e[e.error=2]="error",e[e.filebig=3]="filebig",e[e.loading=4]="loading",e[e.failed=5]="failed",e))(be||{}),C=(e=>(e[e.initing=0]="initing",e[e.default=1]="default",e[e.normal=2]="normal",e[e.optionlist=3]="optionlist",e))(C||{});const ye=k().common,we=S("knowledgeBase",()=>{const e=v(""),l=y=>{e.value=y},o=v([]),i=y=>{o.value=y},f=v(""),p=y=>{f.value=y},h=v([]),u=y=>{h.value=y},b=v(C.initing),x=y=>{b.value=y},A=v(!1);return{currentId:e,setCurrentId:l,knowledgeBaseList:h,setKnowledgeBaseList:u,showDeleteModal:A,setShowDeleteModal:y=>{A.value=y},showDefault:b,setDefault:x,getList:async()=>{var y;try{const d=await M.kbList();if(+d.code==200)if(((y=d==null?void 0:d.data)==null?void 0:y.length)>0){const n=d.data.filter(r=>!/.*_FAQ$/.test(r.kb_name));u(n),x(C.normal),o.value.length||o.value.push(n[0].kb_id)}else x(C.default)}catch(d){U.error(d.msg||ye.error)}},currentKbName:f,setCurrentKbName:p,selectList:o,setSelectList:i}}),Y=k().home,ve=k().common,Be=S("knowledgeModal",()=>{const e=v(!1),l=d=>{e.value=d},o=v(!1),i=d=>{o.value=d},f=v(Y.upload),p=d=>{f.value=d},h=v(""),u=d=>{h.value=d},b=v([]),x=d=>{b.value=d},A=v([]);return{modalVisible:e,setModalVisible:l,urlModalVisible:o,setUrlModalVisible:i,knowledgeName:h,setKnowledgeName:u,fileList:b,setFileList:x,urlList:A,setUrlList:d=>{A.value=d},modalTitle:f,setModalTitle:p,$reset:()=>{e.value=!1,f.value=Y.upload,h.value="",b.value=[],A.value=[]},getFileList:async d=>{try{const n=await M.fileList({kb_id:d});n.code==200&&(n.data.details.forEach(r=>{r.errorText=$(r)}),x(n.data.details))}catch(n){console.log(n),U.error(n.msg||ve.error)}}}}),Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",{currentId:q}=_(we()),Ue=S("option-list",()=>{const e=v([]),l=s=>{e.value=s},o=v([]),i=s=>{o.value=s},f=v(0),p=s=>{f.value=s},h=v(1),u=s=>{h.value=s},b=v(!1),x=s=>{b.value=s},A=v("upload"),E=s=>{A.value=s},T=v(null),y=s=>{T.value=s},d=v(!1),n=s=>{d.value=s},r=v(null),a=async()=>{try{r.value&&clearTimeout(r.value);const s=await R(await M.fileList({kb_id:q.value}));l([]),s==null||s.details.forEach((t,m)=>{e.value.push({id:1e4+m,fileId:t==null?void 0:t.file_id,fileIdName:t==null?void 0:t.file_name,status:t==null?void 0:t.status,bytes:ee((t==null?void 0:t.bytes)||0),createtime:z(t==null?void 0:t.timestamp),errortext:(t==null?void 0:t.status)==="gray"||(t==null?void 0:t.status)==="green"?"":t==null?void 0:t.msg})});const c=s==null?void 0:s.details.some(t=>t.status==="gray");console.log(c),c?(console.log("有解析中的  10后再次请求"),r.value=setTimeout(()=>{clearTimeout(r.value),a()},1e4)):console.log("全部解析完成")}catch(s){console.log(s),U.error(s.msg||"获取知识库详情失败")}},g=v(null),w=async()=>{try{g.value&&clearTimeout(g.value),x(!0);const s=await R(await M.fileList({kb_id:q.value+"_FAQ"}));if(i([]),!(s!=null&&s.details)){console.log("res?.details",s==null?void 0:s.details),p(0),x(!1);return}s==null||s.details.forEach(async(t,m)=>{o.value.push({id:1e4+m,faqId:t==null?void 0:t.file_id,question:t==null?void 0:t.question,answer:t==null?void 0:t.answer,status:t==null?void 0:t.status,bytes:`${t==null?void 0:t.content_length}字符`,createtime:z(t==null?void 0:t.timestamp),picUrlList:[]}),t!=null&&t.picUrlList&&await O(t==null?void 0:t.picUrlList).then(I=>{console.log("成功获取图片文件:",I);const L=t==null?void 0:t.picUrlList.map((D,B)=>({uid:-B,name:"image",status:"done",url:D,originFileObj:I[B]}));o.value[m].picUrlList=L}).catch(I=>{console.error("获取图片文件出错:",I)})});const c=s==null?void 0:s.details.some(t=>t.status==="gray");console.log("flag",c),c?(console.log("有解析中的  5s后再次请求"),g.value=setTimeout(()=>{clearTimeout(g.value),w()},5e3)):console.log("全部解析完成")}catch(s){console.log(s),U.error(s.msg||"获取faq列表失败")}x(!1)};function O(s){const c=s.map(t=>new Promise((m,I)=>{fetch(t).then(L=>L.blob()).then(L=>{const D=t.substring(t.lastIndexOf("/")+1),B=new File([L],D,{type:L.type});m(B)}).catch(L=>{console.error("Error fetching the image:",L),I(L)})}));return Promise.all(c)}return{dataSource:e,setDataSource:l,faqList:o,setFaqList:i,getDetails:a,timer:r,editQaSet:T,setEditQaSet:y,editModalVisible:d,setEditModalVisible:n,faqTimer:g,getFaqList:w,faqType:A,setFaqType:E,total:f,setTotal:p,pageNum:h,setPageNum:u,loading:b,setLoading:x}},{persist:{storage:sessionStorage}});export{Ce as _,we as a,Be as b,C as c,Ie as d,Ue as e,be as f,ne as i,Le as p,Te as r,V as t,Ee as u};
